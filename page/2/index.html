<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="冲出地球，移民宇宙">
<meta property="og:type" content="website">
<meta property="og:title" content="xray的博客">
<meta property="og:url" content="http:&#x2F;&#x2F;chengfangpeng.github.io&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="xray的博客">
<meta property="og:description" content="冲出地球，移民宇宙">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://chengfangpeng.github.io/page/2/"/>





  <title>xray的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">xray的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/08/26/2016-08-26-android_monkeyrunner/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/26/2016-08-26-android_monkeyrunner/" itemprop="url">Android自动化测试工具MonkeyRnnner</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-26T12:00:00+08:00">
                2016-08-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MonkeyRunner测试环境配置"><a href="#MonkeyRunner测试环境配置" class="headerlink" title="MonkeyRunner测试环境配置"></a>MonkeyRunner测试环境配置</h2><ol>
<li><p>android-sdk</p>
<p> 下载android-sdk，配置android-sdk环境变量（当然也包括java环境，配置JAVA_HOME环境变量）</p>
</li>
<li><p>配置python环境</p>
<p> MonkeyRunner基于python环境运行，最好下载2.x版的python,因为我测试代码中用的是2.x的python</p>
</li>
</ol>
<p>配置好后输入monkeyrunner命令如果能进入monkeyrunner的命令交互模式证明安装成功</p>
<p>如图：</p>
<p><img src="http://7xrrm5.com1.z0.glb.clouddn.com/blog-article-monkeyrunner-Selection_056.png" alt=""></p>
<h2 id="MonkeyRunner简介"><a href="#MonkeyRunner简介" class="headerlink" title="MonkeyRunner简介"></a>MonkeyRunner简介</h2><p>MonkeyRunner是什么东西是猴子派来的救兵吗，确实是！MonkeyRunner是Android sdk中一个用于测试的工具，通过它，可以用一个python脚本程序去安装一个android的apk包，运行它，向它发送模拟点击，截取它的用户界面。</p>
<p>下面就是一段很简单的python脚本，通过调用MonkeyRunner的api实现app的自动安装，卸载，截图，打开某个页面。</p>
<p>具体每句代码的作用已经在注释中了</p>
<p>test_install.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/usr/bin/env python</span><br><span class="line"></span><br><span class="line"># encoding: utf-8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from com.android.monkeyrunner import MonkeyRunner, MonkeyDevice, MonkeyImage</span><br><span class="line"></span><br><span class="line"># 该目录是需要改成你自己的目录，将要测试的apk文件放进去，同时产生的截图文件也会保存到该目录下</span><br><span class="line"></span><br><span class="line">dir = &quot;/home/cfp/test/&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 连接手机设备</span><br><span class="line"></span><br><span class="line">device = MonkeyRunner.waitForConnection()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 截图</span><br><span class="line"></span><br><span class="line">result = device.takeSnapshot()</span><br><span class="line"></span><br><span class="line"># 将截图保存到文件</span><br><span class="line"></span><br><span class="line">result.writeToFile(dir + &apos;1.png&apos;,&apos;png&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 卸载APP 参数是旺财谷app的包名</span><br><span class="line"></span><br><span class="line">device.removePackage(&apos;com.yitoudai.wcg&apos;)</span><br><span class="line"></span><br><span class="line">print (&apos;Uninstall Success!&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 暂停5秒</span><br><span class="line"></span><br><span class="line">MonkeyRunner.sleep(5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 截图</span><br><span class="line"></span><br><span class="line">result = device.takeSnapshot()</span><br><span class="line"></span><br><span class="line">result.writeToFile(dir + &apos;2.png&apos;,&apos;png&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装新的APP</span><br><span class="line"></span><br><span class="line">device.installPackage(dir + &apos;wcg.apk&apos;)</span><br><span class="line"></span><br><span class="line">print (&apos;Install Success!&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 截图</span><br><span class="line"></span><br><span class="line">result = device.takeSnapshot()</span><br><span class="line"></span><br><span class="line">result.writeToFile( dir + &apos;3.png&apos;,&apos;png&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 跳转到主页</span><br><span class="line"></span><br><span class="line">device.startActivity(component=&quot;com.yitoudai.wcg/.ui.MainActivity&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#暂停目前正在运行的程序指定的秒数</span><br><span class="line"></span><br><span class="line">#MonkeyRunner.sleep(秒数，浮点数)</span><br><span class="line"></span><br><span class="line">MonkeyRunner.sleep(5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#获取设备的屏蔽缓冲区，产生了整个显示器的屏蔽捕获。（截图）</span><br><span class="line"></span><br><span class="line">result=device.takeSnapshot()</span><br><span class="line"></span><br><span class="line">#返回一个MonkeyImage对象（点阵图包装），我们可以用以下命令将图保存到文件</span><br><span class="line"></span><br><span class="line">result.writeToFile(dir +&apos;4.png&apos;,&apos;png&apos;)</span><br></pre></td></tr></table></figure>



<p>然后在终端中用MonkeyRunner运行test_install.py脚本,就可以看到效果了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">monkeyrunner test_install.py</span><br></pre></td></tr></table></figure>





<p>除了上面脚本文件中用到的命令，还有一些常用的脚本命令</p>
<ul>
<li>重启设备</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">device.reboot()</span><br></pre></td></tr></table></figure>

<ul>
<li>点击屏幕,前两个参数是坐标，第三个是点击事件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">device.touch(100, 100, &apos;DOWN_AND_UP&apos;)</span><br></pre></td></tr></table></figure>

<ul>
<li>在设备上弹出提示信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MonkeyRunner.alert(&quot;Hello World&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li>向编辑区域输入文本“hello”</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">device.type(&apos;hello&apos;)</span><br></pre></td></tr></table></figure>



<p>下面想特别说一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">device.startActivity()这个方法</span><br></pre></td></tr></table></figure>

<p>其实官方文档完整的形式是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">void startActivity ( string uri, string action, string data, string mimetype, iterable categories dictionary extras,component component, iterable flags)</span><br></pre></td></tr></table></figure>



<p>上面的栗子，是跳转到一个不需要传参数的页面，但是app中很多页面是需要传参数的，否则这个页面进去会显示不正常，比如标详情页，需要传入标id</p>
<p>那怎么传呢，其实很简短，因为传的是键值对，对应python中的词典。可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">extra=&#123;&#125;                   </span><br><span class="line"></span><br><span class="line">extra[&apos;deal_id&apos;] = &apos;2334&apos;  </span><br><span class="line"></span><br><span class="line">device.startActivity(extras = extra, component=&quot;com.yitoudai.wcg/.ui.financial.DealDetailActivity&quot;)</span><br></pre></td></tr></table></figure>



<p>上面的代码就是跳转到标详情页的实现,标id是2334</p>
<h2 id="MonkeyRunner-录制和回放脚本"><a href="#MonkeyRunner-录制和回放脚本" class="headerlink" title="MonkeyRunner 录制和回放脚本"></a>MonkeyRunner 录制和回放脚本</h2><p>用上面的方法写脚本测试确实很麻烦，而且要求测试对android项目必须的熟悉。有没有更naocan一点的方法呢，回答是yes,它也是android sdk中的一个工具MonkeyRecorder</p>
<p>运行MonkeyRecorder需要两个脚本：</p>
<ul>
<li>录制脚本：recorder.py</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#!/usr/bin/env monkeyrunner</span><br><span class="line"># Copyright 2010, The Android Open Source Project</span><br><span class="line">#</span><br><span class="line"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line"># you may not use this file except in compliance with the License.</span><br><span class="line"># You may obtain a copy of the License at</span><br><span class="line">#</span><br><span class="line"># http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line">#</span><br><span class="line"># Unless required by applicable law or agreed to in writing, software</span><br><span class="line"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"># See the License for the specific language governing permissions and</span><br><span class="line"># limitations under the License.</span><br><span class="line"></span><br><span class="line">from com.android.monkeyrunner import MonkeyRunner as mr</span><br><span class="line">from com.android.monkeyrunner.recorder import MonkeyRecorder as recorder</span><br><span class="line">device = mr.waitForConnection()</span><br><span class="line">recorder.start(device)</span><br></pre></td></tr></table></figure>



<ul>
<li>回放脚本：recorder_playback.py</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/usr/bin/env monkeyrunner</span><br><span class="line"># Copyright 2010, The Android Open Source Project</span><br><span class="line">#</span><br><span class="line"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line"># you may not use this file except in compliance with the License.</span><br><span class="line"># You may obtain a copy of the License at</span><br><span class="line">#</span><br><span class="line">#     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line">#</span><br><span class="line"># Unless required by applicable law or agreed to in writing, software</span><br><span class="line"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"># See the License for the specific language governing permissions and</span><br><span class="line"># limitations under the License.</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from com.android.monkeyrunner import MonkeyRunner</span><br><span class="line">from com.android.monkeyrunner import MonkeyRunner as mr</span><br><span class="line"></span><br><span class="line"># The format of the file we are parsing is very carfeully constructed.</span><br><span class="line"># Each line corresponds to a single command.  The line is split into 2</span><br><span class="line"># parts with a | character.  Text to the left of the pipe denotes</span><br><span class="line"># which command to run.  The text to the right of the pipe is a python</span><br><span class="line"># dictionary (it can be evaled into existence) that specifies the</span><br><span class="line"># arguments for the command.  In most cases, this directly maps to the</span><br><span class="line"># keyword argument dictionary that could be passed to the underlying</span><br><span class="line"># command.</span><br><span class="line"></span><br><span class="line"># Lookup table to map command strings to functions that implement that</span><br><span class="line"># command.</span><br><span class="line">CMD_MAP = &#123;</span><br><span class="line">    &apos;TOUCH&apos;: lambda dev, arg: dev.touch(**arg),</span><br><span class="line">    &apos;DRAG&apos;: lambda dev, arg: dev.drag(**arg),</span><br><span class="line">    &apos;PRESS&apos;: lambda dev, arg: dev.press(**arg),</span><br><span class="line">    &apos;TYPE&apos;: lambda dev, arg: dev.type(**arg),</span><br><span class="line">    &apos;WAIT&apos;: lambda dev, arg: MonkeyRunner.sleep(**arg)</span><br><span class="line">    &#125;</span><br><span class="line">device= mr.waitForConnection(1,&quot;emulator-5556&quot;)</span><br><span class="line"># Process a single file for the specified device.</span><br><span class="line">def process_file(fp, device):</span><br><span class="line">    for line in fp:</span><br><span class="line">        (cmd, rest) = line.split(&apos;|&apos;)</span><br><span class="line">        try:</span><br><span class="line">            # Parse the pydict</span><br><span class="line">            rest = eval(rest)</span><br><span class="line">        except:</span><br><span class="line">            print &apos;unable to parse options&apos;</span><br><span class="line">            continue</span><br><span class="line"></span><br><span class="line">        if cmd not in CMD_MAP:</span><br><span class="line">            print &apos;unknown command: &apos; + cmd</span><br><span class="line">            continue</span><br><span class="line"></span><br><span class="line">        CMD_MAP[cmd](device, rest)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    file = sys.argv[1]</span><br><span class="line">    fp = open(file, &apos;r&apos;)</span><br><span class="line"></span><br><span class="line">    device = MonkeyRunner.waitForConnection()</span><br><span class="line"></span><br><span class="line">    process_file(fp, device)</span><br><span class="line">    fp.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<p>当执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">monkeyrunner recorder.py</span><br></pre></td></tr></table></figure>



<p>会出现下面的窗口</p>
<p><img src="http://7xrrm5.com1.z0.glb.clouddn.com/blog-article-monkeyrunner-Selection_057.png" alt=""></p>
<p>该窗口的功能：</p>
<ol>
<li><p>可以自动显示手机当前的界面</p>
</li>
<li><p>自动刷新手机的最新状态</p>
</li>
<li><p>点击手机界面可以对手机进行操作，同时反应到真机，而且会在右侧插入操作脚本</p>
</li>
</ol>
<p>4.</p>
<pre><code>- wait: 用来插入下一次操作的时间间隔

- Press a Button: 用来确定需要点击的按钮，包括menu、home、serach,以及对按钮的press、down、up属性

- Type Something: 用来输入内容到输入框

- Fling: 用来进行拖动操作, 可以向上、下、左、右，以及范围的操作

- Export Actions: 用来导出脚本

- Refresh Display: 用来刷新手机界面</code></pre><p>录制的脚本如下：</p>
<p>recorder_action.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">TOUCH|&#123;&apos;x&apos;:698,&apos;y&apos;:1540,&apos;type&apos;:&apos;downAndUp&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TOUCH|&#123;&apos;x&apos;:162,&apos;y&apos;:1836,&apos;type&apos;:&apos;downAndUp&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TOUCH|&#123;&apos;x&apos;:266,&apos;y&apos;:1836,&apos;type&apos;:&apos;downAndUp&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TOUCH|&#123;&apos;x&apos;:563,&apos;y&apos;:1668,&apos;type&apos;:&apos;downAndUp&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TYPE|&#123;&apos;message&apos;:&apos;13310011006&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TOUCH|&#123;&apos;x&apos;:317,&apos;y&apos;:424,&apos;type&apos;:&apos;downAndUp&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TYPE|&#123;&apos;message&apos;:&apos;aaa111222&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TOUCH|&#123;&apos;x&apos;:1002,&apos;y&apos;:152,&apos;type&apos;:&apos;downAndUp&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TOUCH|&#123;&apos;x&apos;:982,&apos;y&apos;:1692,&apos;type&apos;:&apos;downAndUp&apos;,&#125;</span><br><span class="line"></span><br><span class="line">TOUCH|&#123;&apos;x&apos;:587,&apos;y&apos;:1736,&apos;type&apos;:&apos;downAndUp&apos;,&#125;</span><br></pre></td></tr></table></figure>



<p>比如上边的脚本是我记录的登陆操作，我们要回放上面的步骤，只需要执行一下上面的recorder_playback.py脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">monkeyrunner recorder_playback.py  recorder_action.py</span><br></pre></td></tr></table></figure>



<p>第二个脚本就是录制的脚本文件。</p>
<h2 id="MonkeyRunner的测试类型"><a href="#MonkeyRunner的测试类型" class="headerlink" title="MonkeyRunner的测试类型"></a>MonkeyRunner的测试类型</h2><ol>
<li><p>多设备控制</p>
</li>
<li><p>功能测试：例如：你给一个输入框提供值，然后观察输出结果的截屏</p>
</li>
<li><p>回归测试：可以将测试接截屏和正确的结果相比较。MonkeyRunner有个模块提供了该功能。</p>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>要真正在生产环境中使用MonkeyRunner，需要测试能编写python脚本代码，并且对andrfoid的项目有一定的了解，当然前期可以让开发去编写测试代码，但是，测试至少也的能看懂。上面的内用还处于demo的级别，还需要许多工作去做.</p>
<blockquote>
<p>路漫漫其修远兮，吾将上下而求索…</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/05/26/2016-05-26-apk-decomplie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/26/2016-05-26-apk-decomplie/" itemprop="url">Android反编译总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-26T12:00:00+08:00">
                2016-05-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>工欲善其事必先利其器</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Android反编译需要用到一些工具，使用这些工具可以大大的提高我们的工作效率。当然使用工具是一把双刃剑，一方面工具使我们的工作更方便，但另一方面工具把一些原理封装了起来，不利于我们的学习。所以使用工具的时候最好对工具的原理有一定的了解。</p>
<h2 id="jadx"><a href="#jadx" class="headerlink" title="jadx"></a>jadx</h2><p><a href="https://github.com/skylot/jadx" target="_blank" rel="noopener">github地址</a>，jadx是一个将android 的dex文件解码为java的工具。并且有GUI，用起来非常的方便,具体的使用可以看官方的文档。</p>
<h2 id="apktool"><a href="#apktool" class="headerlink" title="apktool"></a>apktool</h2><p>有了上面的工具，可以很方便的将apk的源码进行反编译，让我们了解代码的逻辑。但是这还远远不够，比如我们想干点坏事，将apk反编译后，做点手脚，并把它重新打包发布出去，要实现这样的功能，光上面的工具已经达不到我们的要求了。我们需要另外一个更加强大的工具－<a href="http://ibotpeaches.github.io/Apktool/install/" target="_blank" rel="noopener">apktool</a>.  apktool可以将dex文件反编译成smali文件。如果对smali语法熟悉，就可以在smali中修改app的逻辑。其实apktool这个工具集成了另外一个开源的项目<a href="https://github.com/JesusFreke/smali" target="_blank" rel="noopener">baksmali</a>，(因为apktool集成了baksmail， 假如baksmail修复了bug，需要一段时间才能集成的apktool中，所以我们也可以直接使用baksmail)</p>
<h2 id="smali语法"><a href="#smali语法" class="headerlink" title="smali语法"></a>smali语法</h2><p>为了达到我们对一个apk做手脚的目的，需要了解一种新的语言smali, smail语言类似与汇编语言，如果对汇编比较熟悉的学习起来会比较容易。</p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>下面就举个例子，演示一下怎么利用apktool解包，修改smali文件，重新打包，签名的过程。</p>
<p>首先新建个项目，主要一个MainActivity，里面只有一个字符串，我的目的就是通过解包apk,在smali语法中注入日志打印语句，把这个字符串打印出来:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String hello = &quot;Hello World&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>将项目打包出来的apk（debug包和release包都可以）拷贝到apktool的同级目录</p>
<p><img src="http://7xrrm5.com1.z0.glb.clouddn.com/blog_pic_article_decompile_apk_1.png" alt="目录"></p>
<p>然后将apk包用apktool，反编译，命令为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cfp@cfp:~/tools/android_tools/apktool$ ./apktool d app-release.apk </span><br><span class="line"></span><br><span class="line">I: Using Apktool 2.1.1 on app-release.apk</span><br><span class="line"></span><br><span class="line">I: Loading resource table...</span><br><span class="line"></span><br><span class="line">I: Decoding AndroidManifest.xml with resources...</span><br><span class="line"></span><br><span class="line">I: Loading resource table from file: /home/cfp/apktool/framework/1.apk</span><br><span class="line"></span><br><span class="line">I: Regular manifest package...</span><br><span class="line"></span><br><span class="line">I: Decoding file-resources...</span><br><span class="line"></span><br><span class="line">I: Decoding values */* XMLs...</span><br><span class="line"></span><br><span class="line">I: Baksmaling classes.dex...</span><br><span class="line"></span><br><span class="line">I: Copying assets and libs...</span><br><span class="line"></span><br><span class="line">I: Copying unknown files...</span><br><span class="line"></span><br><span class="line">I: Copying original files...</span><br><span class="line"></span><br><span class="line">cfp@cfp:~/tools/android_tools/apktool$</span><br></pre></td></tr></table></figure>

<p>反编译后多了个app-release目录，反编译的文件就都在里边了，下面的任务就是找到MainActivity，在里边注入日志打印语言，将里边的字符串输出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cfp@cfp:~/tools/android_tools/apktool$ ls</span><br><span class="line"></span><br><span class="line">apktool      app-release      debug.keystore  sign.jar</span><br><span class="line"></span><br><span class="line">apktool.jar  app-release.apk  signapk.jar</span><br></pre></td></tr></table></figure>



<p>反编译后的目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cfp@cfp:~/tools/android_tools/apktool/app-release$ ls</span><br><span class="line"></span><br><span class="line">AndroidManifest.xml  apktool.yml  original  res  smali</span><br></pre></td></tr></table></figure>



<p>所有的smali文件都在smali目录下，我们找到MainActivity.smali文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cfp@cfp:~/tools/android_tools/apktool/app-release/smali/com/xray/smali$ ls</span><br><span class="line"></span><br><span class="line">BuildConfig.smali   R$bool.smali      R$id.smali       R.smali</span><br><span class="line"></span><br><span class="line">MainActivity.smali  R$color.smali     R$integer.smali  R$string.smali</span><br><span class="line"></span><br><span class="line">R$anim.smali        R$dimen.smali     R$layout.smali   R$styleable.smali</span><br><span class="line"></span><br><span class="line">R$attr.smali        R$drawable.smali  R$mipmap.smali   R$style.smali</span><br></pre></td></tr></table></figure>



<p>MainActivity.smali文件中的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.class public Lcom/xray/smali/MainActivity;　＃class的名字</span><br><span class="line"></span><br><span class="line">.super Landroid/support/v7/app/AppCompatActivity;　＃这个类的父类</span><br><span class="line"></span><br><span class="line">.source &quot;MainActivity.java&quot;　＃这个类的java文件名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># direct methods</span><br><span class="line"></span><br><span class="line">.method public constructor &lt;init&gt;()V　＃这个类的构造方法</span><br><span class="line"></span><br><span class="line">    .locals 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .prologue</span><br><span class="line"></span><br><span class="line">    .line 7　＃行号</span><br><span class="line"></span><br><span class="line">    invoke-direct &#123;p0&#125;, Landroid/support/v7/app/AppCompatActivity;-&gt;&lt;init&gt;()V　＃调用父类的构造方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return-void　＃返回空</span><br><span class="line"></span><br><span class="line">.end method</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># virtual methods</span><br><span class="line"></span><br><span class="line">.method protected onCreate(Landroid/os/Bundle;)V　＃onCreate方法</span><br><span class="line"></span><br><span class="line">    .locals 2</span><br><span class="line"></span><br><span class="line">    .param p1, &quot;savedInstanceState&quot;    # Landroid/os/Bundle;　#方法的参数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .prologue</span><br><span class="line"></span><br><span class="line">    .line 11</span><br><span class="line"></span><br><span class="line">    invoke-super &#123;p0, p1&#125;, Landroid/support/v7/app/AppCompatActivity;-&gt;onCreate(Landroid/os/Bundle;)V　</span><br><span class="line"></span><br><span class="line">＃父类的构造方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .line 12</span><br><span class="line"></span><br><span class="line">    const v1, 0x7f040019</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;p0, v1&#125;, Lcom/xray/smali/MainActivity;-&gt;setContentView(I)V　#调用serContentView方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .line 13</span><br><span class="line"></span><br><span class="line">    const-string v0, &quot;Hello World&quot;　＃字符串Hello World，保存在寄存器v0中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .line 15</span><br><span class="line"></span><br><span class="line">    .local v0, &quot;hello&quot;:Ljava/lang/String;　＃变量hello ,类型为String</span><br><span class="line"></span><br><span class="line">    return-void</span><br><span class="line"></span><br><span class="line">.end method</span><br></pre></td></tr></table></figure>

<p>前面说了smali语言有点像汇编，通过上面的注释大概能了解这个smali文件的大概意思，要想输出Hello World，我么可以加上调用Log的smali语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const-string v1, &quot;TAG&quot;</span><br><span class="line"></span><br><span class="line">invoke-static &#123;v1, v0&#125;, Landroid/util/Log;-&gt;d(Ljava/lang/String;Ljava/lang/String;)I</span><br></pre></td></tr></table></figure>

<p>修改后的MainActivity.smali文件变成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.class public Lcom/xray/smali/MainActivity;　＃class的名字</span><br><span class="line"></span><br><span class="line">.super Landroid/support/v7/app/AppCompatActivity;　＃这个类的父类</span><br><span class="line"></span><br><span class="line">.source &quot;MainActivity.java&quot;　＃这个类的java文件名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># direct methods</span><br><span class="line"></span><br><span class="line">.method public constructor &lt;init&gt;()V　＃这个类的构造方法</span><br><span class="line"></span><br><span class="line">    .locals 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .prologue</span><br><span class="line"></span><br><span class="line">    .line 7　＃行号</span><br><span class="line"></span><br><span class="line">    invoke-direct &#123;p0&#125;, Landroid/support/v7/app/AppCompatActivity;-&gt;&lt;init&gt;()V　＃调用父类的构造方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return-void　＃返回空</span><br><span class="line"></span><br><span class="line">.end method</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># virtual methods</span><br><span class="line"></span><br><span class="line">.method protected onCreate(Landroid/os/Bundle;)V　＃onCreate方法</span><br><span class="line"></span><br><span class="line">    .locals 2</span><br><span class="line"></span><br><span class="line">    .param p1, &quot;savedInstanceState&quot;    # Landroid/os/Bundle;　#方法的参数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .prologue</span><br><span class="line"></span><br><span class="line">    .line 11</span><br><span class="line"></span><br><span class="line">    invoke-super &#123;p0, p1&#125;, Landroid/support/v7/app/AppCompatActivity;-&gt;onCreate(Landroid/os/Bundle;)V　</span><br><span class="line"></span><br><span class="line">＃父类的构造方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .line 12</span><br><span class="line"></span><br><span class="line">    const v1, 0x7f040019</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;p0, v1&#125;, Lcom/xray/smali/MainActivity;-&gt;setContentView(I)V　#调用serContentView方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .line 13</span><br><span class="line"></span><br><span class="line">    const-string v0, &quot;Hello World&quot;　＃字符串Hello World，保存在寄存器v0中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .line 15</span><br><span class="line"></span><br><span class="line">    .local v0, &quot;hello&quot;:Ljava/lang/String;　＃变量hello ,类型为String</span><br><span class="line"></span><br><span class="line">    const-string v1, &quot;TAG&quot;</span><br><span class="line"></span><br><span class="line">    invoke-static &#123;v1, v0&#125;, Landroid/util/Log;-&gt;d(Ljava/lang/String;Ljava/lang/String;)I</span><br><span class="line"></span><br><span class="line">    return-void</span><br><span class="line"></span><br><span class="line">.end method</span><br></pre></td></tr></table></figure>



<p>然后重新打包:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cfp@cfp:~/tools/android_tools/apktool$ ./apktool b app-release</span><br><span class="line"></span><br><span class="line">I: Using Apktool 2.1.1</span><br><span class="line"></span><br><span class="line">I: Checking whether sources has changed...</span><br><span class="line"></span><br><span class="line">I: Smaling smali folder into classes.dex...</span><br><span class="line"></span><br><span class="line">I: Checking whether resources has changed...</span><br><span class="line"></span><br><span class="line">I: Building resources...</span><br><span class="line"></span><br><span class="line">I: Building apk file...</span><br><span class="line"></span><br><span class="line">I: Copying unknown files/dir...</span><br></pre></td></tr></table></figure>

<p>新的apk包位于</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app-release/dist</span><br></pre></td></tr></table></figure>

<p>这个apk包是不能直接安装的，需要用签名工具签名，可以使用另外一个工具<a href="https://github.com/appium/sign" target="_blank" rel="noopener">sign.jar</a>,命令为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cfp@cfp:~/tools/android_tools/apktool$ java -jar sign.jar app-release.apk</span><br></pre></td></tr></table></figure>

<p>签名后的新包叫app-release.s.apk，直接安装就可以打印Hello World的日志了。</p>
<p>﻿</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">05-25 22:56:25.725 17277-17277/com.xray.smali D/TAG: Hello World</span><br></pre></td></tr></table></figure>









































<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><p><a href="http://blog.isming.me/2015/01/14/android-decompile-smali/" target="_blank" rel="noopener">smali语法</a></p>
</li>
<li><p><a href="http://drops.wooyun.org/papers/6045" target="_blank" rel="noopener">http://drops.wooyun.org/papers/6045</a></p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/04/25/2016-05-25-retrofit_introduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/25/2016-05-25-retrofit_introduce/" itemprop="url">Retrofit介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-25T12:00:00+08:00">
                2016-04-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Retrofit是Square开发的一个用于网络请求的开源库，内部封装了okhttp,并且和RxAndroid完美的兼容，使得Android的开发效率增加不少的同时也使代码变得清晰易读。</p>
<h2 id="Gradle-依赖"><a href="#Gradle-依赖" class="headerlink" title="Gradle 依赖"></a>Gradle 依赖</h2><p>retrofit可以很方便的使用Maven和Gradle依赖，在1.x时retrofit默认是没有引入okhttp作为http client,需要手动的依赖。但是2.0版本已经将okhttp作为retrofit的默认http client,引入retrofit2只需要在gradle中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">compile &apos;com.squareup.retrofit2:retrofit:2.0.0&apos;</span><br></pre></td></tr></table></figure>

<p>如果你不想使用retrofit2中自带的okhttp，你也可以导入你自己的okhttp,为了避免导入冲突可以按下面的依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">compile (&apos;com.squareup.retrofit2:retrofit:2.0.0&apos;) &#123;  </span><br><span class="line"></span><br><span class="line">  exclude module: &apos;okhttp&apos;</span><br><span class="line">&#125;</span><br><span class="line">compile &apos;com.squareup.okhttp3:okhttp:3.2.0&apos;</span><br></pre></td></tr></table></figure>



<p>retrofit2默认没有导入gson,需要gson作为转换器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">compile &apos;com.squareup.retrofit2:converter-gson:2.0.0&apos;</span><br></pre></td></tr></table></figure>



<p>与RxAndroid使用需要依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">compile &apos;com.squareup.retrofit2:adapter-rxjava:2.0.0&apos;  </span><br><span class="line">compile &apos;io.reactivex:rxandroid:1.0.1&apos;</span><br></pre></td></tr></table></figure>



<h2 id="请求参数注解说明"><a href="#请求参数注解说明" class="headerlink" title="请求参数注解说明"></a>请求参数注解说明</h2><h4 id="Query-QueryMap"><a href="#Query-QueryMap" class="headerlink" title="@Query @QueryMap"></a>@Query @QueryMap</h4><p>Http Get请求参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@GET(&quot;group/users&quot;)</span><br><span class="line">Call&lt;List&lt;User&gt;&gt; groupList(@Query(&quot;id&quot;) int groupId);</span><br></pre></td></tr></table></figure>



<p>等同于</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@GET(&quot;group/users?id=groupId&quot;)</span><br></pre></td></tr></table></figure>



<p>多个请求参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">@GET(&quot;group/&#123;id&#125;/users&quot;)</span><br><span class="line">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId, @QueryMap Map&lt;String, String&gt; options);</span><br></pre></td></tr></table></figure>







<h4 id="Field"><a href="#Field" class="headerlink" title="@Field"></a>@Field</h4><p>用于Post方式传递参数,需要在请求接口方法上添加@FormUrlEncoded,表示以表单的方式传递参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@FormUrlEncoded</span><br><span class="line">@POST(&quot;user/edit&quot;)</span><br><span class="line">Call&lt;User&gt; updateUser(@Field(&quot;first_name&quot;) String first, @Field(&quot;last_name&quot;) String last);</span><br></pre></td></tr></table></figure>



<h4 id="Path"><a href="#Path" class="headerlink" title="@Path"></a>@Path</h4><p>用于URL占位符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@GET(&quot;group/&#123;id&#125;/users&quot;)</span><br><span class="line">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId);</span><br></pre></td></tr></table></figure>



<h4 id="Header"><a href="#Header" class="headerlink" title="@Header"></a>@Header</h4><p>添加http header</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@GET(&quot;user&quot;)</span><br><span class="line">Call&lt;User&gt; getUser(@Header(&quot;Authorization&quot;) String authorization)</span><br></pre></td></tr></table></figure>



<h4 id="Body"><a href="#Body" class="headerlink" title="@Body"></a>@Body</h4><p>请求体，对象会被自动转化成Json格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">@POST(&quot;users/new&quot;)</span><br><span class="line">Call&lt;User&gt; createUser(@Body User user);</span><br></pre></td></tr></table></figure>



<h2 id="拦截器Interceptor"><a href="#拦截器Interceptor" class="headerlink" title="拦截器Interceptor"></a>拦截器Interceptor</h2><p>retrofit2默认的集成了okhttp, okhttp可以设置拦截器，比如个请求添加统一的Header</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">httpClient.addNetworkInterceptor(new Interceptor() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Response intercept(Chain chain) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        Request request = chain.request();</span><br><span class="line">        Request.Builder requestBuilder = request.newBuilder().addHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span><br><span class="line">        Request request1 = requestBuilder.build();</span><br><span class="line"></span><br><span class="line">        return chain.proceed(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="Post多个参数提交"><a href="#Post多个参数提交" class="headerlink" title="Post多个参数提交"></a>Post多个参数提交</h4><p>如果有很多默认的参数需要每次添加时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@FormUrlEncoded</span><br><span class="line">@POST(&quot;/feedback&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; sendFeedbackSimple(  </span><br><span class="line">    @Field(&quot;osName&quot;) String osName,</span><br><span class="line">    @Field(&quot;osVersion&quot;) int osVersion,</span><br><span class="line">    @Field(&quot;device&quot;) String device,</span><br><span class="line">    @Field(&quot;message&quot;) String message,</span><br><span class="line">    @Field(&quot;userIsATalker&quot;) Boolean userIsATalker);</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private void sendFeedbackFormSimple(@NonNull String message) &#123;  </span><br><span class="line">    // create the service to make the call, see first Retrofit blog post</span><br><span class="line">    FeedbackService taskService = ServiceGenerator.create(FeedbackService.class);</span><br><span class="line"></span><br><span class="line">    // create flag if message is especially long</span><br><span class="line">    boolean userIsATalker = (message.length() &gt; 200);</span><br><span class="line"></span><br><span class="line">    Call&lt;ResponseBody&gt; call = taskService.sendFeedbackSimple(</span><br><span class="line">            &quot;Android&quot;,</span><br><span class="line">            android.os.Build.VERSION.SDK_INT,</span><br><span class="line">            Build.MODEL,</span><br><span class="line">            message,</span><br><span class="line">            userIsATalker</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    call.enqueue(new Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以写成下面的形式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@POST(&quot;/feedback&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; sendFeedbackConstant(@Body UserFeedback feedbackObject);  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class UserFeedback &#123;</span><br><span class="line"></span><br><span class="line">    private String osName = &quot;Android&quot;;</span><br><span class="line">    private int osVersion = android.os.Build.VERSION.SDK_INT;</span><br><span class="line">    private String device = Build.MODEL;</span><br><span class="line">    private String message;</span><br><span class="line">    private boolean userIsATalker;</span><br><span class="line"></span><br><span class="line">    public UserFeedback(String message) &#123;</span><br><span class="line">        this.message = message;</span><br><span class="line">        this.userIsATalker = (message.length() &gt; 200);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // getters &amp; setters</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private void sendFeedbackFormAdvanced(@NonNull String message) &#123;  </span><br><span class="line">    FeedbackService taskService = ServiceGenerator.create(FeedbackService.class);</span><br><span class="line"></span><br><span class="line">    Call&lt;ResponseBody&gt; call = taskService.sendFeedbackConstant(new UserFeedback(message));</span><br><span class="line"></span><br><span class="line">    call.enqueue(new Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Retrofit2-RxAndroid-封装和使用"><a href="#Retrofit2-RxAndroid-封装和使用" class="headerlink" title="Retrofit2 + RxAndroid 封装和使用"></a>Retrofit2 + RxAndroid 封装和使用</h2><p>首先创建一个工厂类根据不通的api interface 创建其实现。这个解释起来比较抽象，可以看下面的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by cfp on 16-4-18.</span><br><span class="line"> */</span><br><span class="line">public class RetrofitFactory &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static final String GITHUB_HTTP_URL = &quot;https://api.github.com&quot;;</span><br><span class="line"></span><br><span class="line">    public static final String OTHER_HTTP_URL = &quot;https://yoursite&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //默认超时时间</span><br><span class="line">    private final static int DEFAULT_TIMEOUT = 5;</span><br><span class="line"></span><br><span class="line">    private static OkHttpClient.Builder httpClient = new OkHttpClient.Builder();</span><br><span class="line"></span><br><span class="line">    private static Retrofit.Builder githubBuilder = new Retrofit.Builder()</span><br><span class="line">            .baseUrl(GITHUB_HTTP_URL)</span><br><span class="line">            .addCallAdapterFactory(RxJavaCallAdapterFactory.create())</span><br><span class="line">            .addConverterFactory(GsonConverterFactory.create());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static Retrofit.Builder otherBuilder = new Retrofit.Builder()</span><br><span class="line">            .baseUrl(OTHER_HTTP_URL)</span><br><span class="line">            .addCallAdapterFactory(RxJavaCallAdapterFactory.create())</span><br><span class="line">            .addConverterFactory(GsonConverterFactory.create());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 为了防止一个类里放置所有的api,可以根据程序的功能分成不通的模块，把他们存在map中</span><br><span class="line">     */</span><br><span class="line">    private static Map&lt;Class&lt;?&gt;, Object&gt; githubApiMap = new HashMap&lt;Class&lt;?&gt;, Object&gt;();</span><br><span class="line">    private static Map&lt;Class&lt;?&gt;, Object&gt; otherApiMap = new HashMap&lt;Class&lt;?&gt;, Object&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 默认的server为github</span><br><span class="line">     *</span><br><span class="line">     * @param instanceClass</span><br><span class="line">     * @param &lt;S&gt;</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public synchronized static &lt;S&gt; S getInstance(Class&lt;S&gt; instanceClass) &#123;</span><br><span class="line"></span><br><span class="line">        return getInstance(GITHUB_HTTP_URL, instanceClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public RetrofitFactory() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public synchronized static &lt;S&gt; S getInstance(String server, Class&lt;S&gt; instanceClass) &#123;</span><br><span class="line"></span><br><span class="line">        final Retrofit retrofit;</span><br><span class="line"></span><br><span class="line">        switch (server) &#123;</span><br><span class="line"></span><br><span class="line">            case GITHUB_HTTP_URL:</span><br><span class="line"></span><br><span class="line">                if (githubApiMap.containsKey(instanceClass)) &#123;</span><br><span class="line"></span><br><span class="line">                    return (S) githubApiMap.get(instanceClass);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    //添加拦截器，可以给请求添加header</span><br><span class="line">                    httpClient.addNetworkInterceptor(new Interceptor() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public Response intercept(Chain chain) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">                            Request origin = chain.request();</span><br><span class="line">                            Request.Builder requestBuilder = origin.newBuilder()</span><br><span class="line">                                    .addHeader(&quot;devicetype&quot;, &quot;ANDROID&quot;);</span><br><span class="line">                            Request request = requestBuilder.build();</span><br><span class="line"></span><br><span class="line">                            return chain.proceed(request);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    retrofit = githubBuilder.client(httpClient.build()).build();</span><br><span class="line">                    S instance = retrofit.create(instanceClass);</span><br><span class="line">                    githubApiMap.put(instanceClass, instance);</span><br><span class="line">                    return instance;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            case OTHER_HTTP_URL:</span><br><span class="line"></span><br><span class="line">                if (otherApiMap.containsKey(instanceClass)) &#123;</span><br><span class="line"></span><br><span class="line">                    return (S) githubApiMap.get(instanceClass);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line"></span><br><span class="line">                    retrofit = githubBuilder.client(httpClient.build()).build();</span><br><span class="line">                    S instance = retrofit.create(instanceClass);</span><br><span class="line">                    otherApiMap.put(instanceClass, instance);</span><br><span class="line">                    return instance;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            default:</span><br><span class="line">                return null;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>另外就是网络请求的抽象回调类，继承自Subscriber</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 网络请求的回调抽象类</span><br><span class="line"> * Created by cfp on 16-5-24.</span><br><span class="line"> */</span><br><span class="line">public abstract class AbsCallBackSubscriber&lt;T&gt; extends Subscriber&lt;T&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line"></span><br><span class="line">        //解除注册</span><br><span class="line">        if (this.isUnsubscribed())&#123;</span><br><span class="line"></span><br><span class="line">            this.unsubscribe();</span><br><span class="line">        &#125;</span><br><span class="line">        onFinish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onError(Throwable e) &#123;</span><br><span class="line">        // TODO: 16-5-25 一些错误处理</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onNext(T t) &#123;</span><br><span class="line">        onSuccess(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract void onFinish();</span><br><span class="line">    public abstract void onSuccess(T t);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>最后是真正的网络请求部分，如果有需求某次请求的错误信息需要单独处理，可以复写</p>
<p>AbsCallBackSubscriber中的onError方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">RetrofitFactory.getInstance(GithubApi.class).getFollowings(username)</span><br><span class="line">        .subscribeOn(Schedulers.io())</span><br><span class="line">        .unsubscribeOn(Schedulers.io())</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .subscribe(new AbsCallBackSubscriber&lt;List&lt;UserInfo&gt;&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onFinish() &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onSuccess(List&lt;UserInfo&gt; userInfos) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>最后是接口的interface</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by cfp on 16-4-18.</span><br><span class="line"> */</span><br><span class="line">public interface GithubApi &#123;</span><br><span class="line"></span><br><span class="line">    @GET(&quot;/users/&#123;username&#125;&quot;)</span><br><span class="line">    Observable&lt;UserInfo&gt; getUserInfo(@Path(&quot;username&quot;) String username);</span><br><span class="line">    @GET(&quot;/users/&#123;username&#125;/following&quot;)</span><br><span class="line">    Observable&lt;List&lt;UserInfo&gt;&gt; getFollowings(@Path(&quot;username&quot;) String username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>retrofit2 + reAndroid简单的流程用法差不多介绍了，也做了个简单的封装，至于更高级的用法，还需要继续的研究，也希望大家多多交流，指出不足共同进步^v^。</p>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><ol>
<li><p><a href="http://www.loongwind.com/archives/242.html" target="_blank" rel="noopener">http://www.loongwind.com/archives/242.html</a></p>
</li>
<li><p><a href="http://xiuweikang.github.io/2016/03/17/Retrofit%E5%88%86%E4%BA%AB/" target="_blank" rel="noopener">http://xiuweikang.github.io/2016/03/17/Retrofit%E5%88%86%E4%BA%AB/</a></p>
</li>
<li><p><a href="https://futurestud.io/blog/retrofit-2-upgrade-guide-from-1-9" target="_blank" rel="noopener">https://futurestud.io/blog/retrofit-2-upgrade-guide-from-1-9</a></p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/03/23/2016-03-23-2016%E4%B9%A6%E5%8D%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/23/2016-03-23-2016%E4%B9%A6%E5%8D%95/" itemprop="url">2016年书单</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-23T12:00:00+08:00">
                2016-03-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="读完"><a href="#读完" class="headerlink" title="读完"></a>读完</h2><ul>
<li><p><a href="https://git-scm.com/book/zh/v2" target="_blank" rel="noopener">Pro-Git</a> 作者是github的创始人</p>
</li>
<li><p><a href="http://www.cnblogs.com/vamei/archive/2012/12/05/2802811.html" target="_blank" rel="noopener">协议森林</a>用很直白但却很形象的文字帮助读者了解网络协议，读过这一系列文章后，你可以找到参考书籍，继续深入学习。</p>
</li>
<li><p><a href="http://www.cnblogs.com/vamei/archive/2012/09/13/2682778.html" target="_blank" rel="noopener">Python快速教程</a> 文中代码主要基于python2.7.</p>
</li>
</ul>
<h2 id="在读"><a href="#在读" class="headerlink" title="在读"></a>在读</h2><ul>
<li><p><a href="https://book.douban.com/subject/1088054/" target="_blank" rel="noopener">TCP/IP详解　卷一：协议</a> 不多说了该领域的经典</p>
</li>
<li><p><a href="https://book.douban.com/subject/26649050/" target="_blank" rel="noopener">App研发录</a> 进阶必备</p>
</li>
<li><p><a href="https://book.douban.com/subject/26599538/" target="_blank" rel="noopener">Android开发艺术探索</a> 侧重于Android知识的体系化和体统工作机制的分析。</p>
</li>
<li><p><a href="https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md" target="_blank" rel="noopener">命令行的艺术</a>　　步入大神的行列</p>
</li>
</ul>
<h2 id="想读"><a href="#想读" class="headerlink" title="想读"></a>想读</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/03/09/2016-03-10-Base64%E7%BC%96%E7%A0%81%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/09/2016-03-10-Base64%E7%BC%96%E7%A0%81%E8%A7%A3%E6%9E%90/" itemprop="url">Base64编码解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-09T12:00:00+08:00">
                2016-03-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Base64原理简介"><a href="#Base64原理简介" class="headerlink" title="Base64原理简介"></a>Base64原理简介</h2><p>Base64是一种基于６４个可打印字符来表示二进制数据的表示方法，严格来讲并不是加密方法，仅仅是表示方法。由于每６bit为一个单元。三个字节有24个bit，对应于４个Base64单元</p>
<p><img src="http://7xrrm5.com1.z0.glb.clouddn.com/blog_pic_article_2016-03-11-base64-1.png" alt="Base64索引表"></p>
<p>这么说可能稍微有点抽象，举个例子就明白了，比如 “Man” 这个单词由3个字节，也就是24bit组成,按我们前面说的如果用Base64编码的话，由４个Base64单元组成。具体可以看下面的图</p>
<p><img src="http://7xrrm5.com1.z0.glb.clouddn.com/blog_pic_article_2016-03-11-base64-2.png" alt=""></p>
<p>所以”Man”这个单词用Base64编码的结果为”TWFu”</p>
<p>但是我们举得这个例子有点特殊，“Man”正好有3个字节，24bit正好转成４个Base64,　如果转码的数据不是３的倍数。</p>
<p>最后会多长１个或２个字节，那么可以使用下面的方法处理：先使用０字节值在末尾补足，使其能够被３整除，然后再进行base64的编码。在编码后的base64文本后加上一个或两个‘＝’号，代表补足的字节数。也就是说，当最后剩余一个八位字节（一个byte）时，最后一个6位的base64字节块有四位是0值，最后附加上两个等号；如果最后剩余两个八位字节（2个byte）时，最后一个6位的base字节块有两位是0值，最后附加一个等号。</p>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><ul>
<li>在终端命令行中编字符串</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">echo &quot;hello&quot; | base64</span><br></pre></td></tr></table></figure>


<p>注：在Ubuntu上使用　echo “hello” | base64 时或出现多编码字符的情况，这个是因为UTF-8编码的原因</p>
<p>从指定的文件file中读取数据，编码为base64字符串输出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">base64 file</span><br></pre></td></tr></table></figure>

<p>从标准输入中读取已经进行base64编码的内容，解码输出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64 -d</span><br></pre></td></tr></table></figure>

























          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/03/09/2016-03-09-Php%E7%AC%94%E8%AE%B0-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/09/2016-03-09-Php%E7%AC%94%E8%AE%B0-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" itemprop="url">Php笔记-基础语法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-09T12:00:00+08:00">
                2016-03-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>php 的变量必须用$开头</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$myAge</span><br></pre></td></tr></table></figure>

<h2 id="switch语法"><a href="#switch语法" class="headerlink" title="switch语法"></a>switch语法</h2><p>switch有两种语法：</p>
<ul>
<li>正常的语法：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">        $myAge = 25;</span><br><span class="line">        switch($myAge)&#123;</span><br><span class="line">            case 20:</span><br><span class="line">                print &quot;your are age is 20&quot;;</span><br><span class="line">                break;</span><br><span class="line">            case 24:</span><br><span class="line">                print &quot;your are age is 24&quot;;</span><br><span class="line">                break;</span><br><span class="line">            case 25:</span><br><span class="line">                print &quot;your are age is 25&quot;;</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                print &quot;your are age is not match&quot;;</span><br><span class="line">                break;</span><br><span class="line">      </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>sugar语法：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">        $myAge = 25;</span><br><span class="line">        switch($myAge):</span><br><span class="line">            case 20:</span><br><span class="line">                print &quot;your are age is 20&quot;;</span><br><span class="line">                break;</span><br><span class="line">            case 24:</span><br><span class="line">                print &quot;your are age is 24&quot;;</span><br><span class="line">                break;</span><br><span class="line">            case 25:</span><br><span class="line">                print &quot;your are age is 25&quot;;</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                print &quot;your are age is not match&quot;;</span><br><span class="line">                break;</span><br><span class="line">        endswitch;</span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$array = array(&quot;cheng&quot;, &quot;fang&quot;, &quot;peng&quot;);</span><br></pre></td></tr></table></figure>
<h4 id="获取数组的值有两种方法"><a href="#获取数组的值有两种方法" class="headerlink" title="获取数组的值有两种方法"></a>获取数组的值有两种方法</h4><ul>
<li>通过[]</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$array[2]；</span><br></pre></td></tr></table></figure>

<ul>
<li>通过{}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$array&#123;2&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数组中删除元素"><a href="#数组中删除元素" class="headerlink" title="数组中删除元素"></a>数组中删除元素</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unset(array[2]);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">       $languages = array(&quot;HTML/CSS&quot;,</span><br><span class="line">       &quot;JavaScript&quot;, &quot;PHP&quot;, &quot;Python&quot;, &quot;Ruby&quot;);</span><br><span class="line">     </span><br><span class="line">       unset($languages[3]);</span><br><span class="line">                   </span><br><span class="line">       foreach($languages as $lang) &#123;</span><br><span class="line">         print &quot;&lt;p&gt;$lang&lt;/p&gt;&quot;;</span><br><span class="line">       &#125;</span><br><span class="line">       /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">       // 输出前五个偶数</span><br><span class="line">       for ($i = 2; $i &lt; 11; $i = $i + 2) &#123;</span><br><span class="line">         echo $i;</span><br><span class="line">       &#125;</span><br><span class="line">     ?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="foreach循环"><a href="#foreach循环" class="headerlink" title="foreach循环"></a>foreach循环</h2><p>foreach循环是迭代对象里的每一个元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">         $langs = array(&quot;JavaScript&quot;,</span><br><span class="line">         &quot;HTML/CSS&quot;, &quot;PHP&quot;,</span><br><span class="line">         &quot;Python&quot;, &quot;Ruby&quot;);</span><br><span class="line">       </span><br><span class="line">         foreach ($langs as $lang) &#123;</span><br><span class="line">             echo &quot;&lt;li&gt;$lang&lt;/li&gt;&quot;;</span><br><span class="line">         &#125;</span><br><span class="line">       </span><br><span class="line">         unset($lang);</span><br><span class="line">       ?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="while-循环"><a href="#while-循环" class="headerlink" title="while 循环"></a>while 循环</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$headCount = 0;</span><br><span class="line">	$flipCount = 0;</span><br><span class="line">	while ($headCount &lt; 3) &#123;</span><br><span class="line">		$flip = rand(0,1);</span><br><span class="line">		$flipCount ++;</span><br><span class="line">		if ($flip)&#123;</span><br><span class="line">			$headCount ++;</span><br><span class="line">			echo &quot;&lt;div class=\&quot;coin\&quot;&gt;H&lt;/div&gt;&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		else &#123;</span><br><span class="line">			$headCount = 0;</span><br><span class="line">			echo &quot;&lt;div class=\&quot;coin\&quot;&gt;T&lt;/div&gt;&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	echo &quot;&lt;p&gt;It took &#123;$flipCount&#125; flips!&lt;/p&gt;&quot;;</span><br><span class="line">	?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="endwhile的使用"><a href="#endwhile的使用" class="headerlink" title="endwhile的使用"></a>endwhile的使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	 $isLoop = true;</span><br><span class="line">	 $index = 0;</span><br><span class="line">    while($isLoop):</span><br><span class="line">        if($index &gt; 10)&#123;</span><br><span class="line">            $isLoop = false;</span><br><span class="line">            &#125;</span><br><span class="line">            echo $index;</span><br><span class="line">            $index++;</span><br><span class="line">    endwhile;</span><br><span class="line">        ?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="do-while的使用"><a href="#do-while的使用" class="headerlink" title="do-while的使用"></a>do-while的使用</h4><p>先执行do中的代码，然后再执行while循环</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$flipCount = 0;</span><br><span class="line">	do &#123;</span><br><span class="line">		$flip = rand(0,1);</span><br><span class="line">		$flipCount ++;</span><br><span class="line">		if ($flip)&#123;</span><br><span class="line">			echo &quot;&lt;div class=\&quot;coin\&quot;&gt;H&lt;/div&gt;&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		else &#123;</span><br><span class="line">			echo &quot;&lt;div class=\&quot;coin\&quot;&gt;T&lt;/div&gt;&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; while ($flip);</span><br><span class="line">	$verb = &quot;were&quot;;</span><br><span class="line">	$last = &quot;flips&quot;;</span><br><span class="line">	if ($flipCount == 1) &#123;</span><br><span class="line">		$verb = &quot;was&quot;;</span><br><span class="line">		$last = &quot;flip&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	echo &quot;&lt;p&gt;There &#123;$verb&#125; &#123;$flipCount&#125; &#123;$last&#125;!&lt;/p&gt;&quot;;</span><br><span class="line">	?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h4 id="字符串内建函数"><a href="#字符串内建函数" class="headerlink" title="字符串内建函数"></a>字符串内建函数</h4><ul>
<li>strlen 返回字符串的长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">       $name = &quot;chengfangpeng&quot;;</span><br><span class="line">       print strlen($name);</span><br><span class="line">   ?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>substr 截取字符串函数，返回截取到的子字符串</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">     $name = &quot;chengfangpeng&quot;;</span><br><span class="line">   print substr($name, 5, 10);</span><br><span class="line">  ?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>strtoupper 将字符串转为大写</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">   $name = &quot;chengfangpeng&quot;;</span><br><span class="line">   print strtoupper($name);</span><br><span class="line">   ?&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>strtolower 将字符串转为小写</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  $name = &quot;CHENGFANGPENG&quot;;</span><br><span class="line">  print strtolower($name);</span><br><span class="line">  ?&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>strpos 找出字符串中某个子字符串的位置，如果没有所给的字符串，返回false，否则返回子字符串在原字符串中的位置。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  </span><br><span class="line">   $name = &quot;chengfangpeng&quot;;</span><br><span class="line">   print strpos($name, &quot;fang&quot;);</span><br><span class="line">   </span><br><span class="line">if(strpos($name, &quot;Hello&quot;) === false)&#123;</span><br><span class="line">       print &quot;no match string&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">   ?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="数学内建函数"><a href="#数学内建函数" class="headerlink" title="数学内建函数"></a>数学内建函数</h4><ul>
<li>round 将一个float类型的数，四舍五入为整形，如果再传入保留位数参数可以转化成保留小数位的float类型。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">     print round(M_PI); //3</span><br><span class="line">     print round(M_PI, 3);//3.142</span><br><span class="line">   ?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//使用rand，strlen，substr函数随机打印你姓名中的一个字母</span><br><span class="line"> &lt;?php</span><br><span class="line">  </span><br><span class="line">    $name = &quot;chengfangpeng&quot;;</span><br><span class="line">    $rIndex = rand(0, strlen($name));</span><br><span class="line">    print substr($name, $rIndex, 1);</span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure>










          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/02/21/2016-02-21-Ubuntu%E5%AE%89%E8%A3%85Fiddler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/02/21/2016-02-21-Ubuntu%E5%AE%89%E8%A3%85Fiddler/" itemprop="url">Ubuntu安装Fiddler</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-21T12:00:00+08:00">
                2016-02-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Fiddler 是Windows上一个非常强大的抓包工具，其实在Ubuntu上也是可以安装的，具体的方法如下：</p>
<h2 id="安装mono"><a href="#安装mono" class="headerlink" title="安装mono"></a>安装mono</h2><p>fiddler是基于.net开发，所以安装fidder前需要安装.net framework。而.net framework 只能运行在windows，针对linux和mac操作系统，可通过安装mono framework 来支持fiddler运行。<br>安装命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install  mono-complete</span><br></pre></td></tr></table></figure>

<h2 id="下载Fiddler"><a href="#下载Fiddler" class="headerlink" title="下载Fiddler"></a>下载Fiddler</h2><p><a href="http://fiddler.wikidot.com/mono" target="_blank" rel="noopener">下载地址</a><br>下载Fiddler for Mono Current Linux build<br>解压</p>
<h2 id="运行Fiddler"><a href="#运行Fiddler" class="headerlink" title="运行Fiddler"></a>运行Fiddler</h2><p>进入解压目录直接运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fiddler.exe</span><br></pre></td></tr></table></figure>
<p>就可以使用了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/01/10/2016-01-07-ubuntu%E6%88%AA%E5%9B%BE%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/10/2016-01-07-ubuntu%E6%88%AA%E5%9B%BE%E5%B7%A5%E5%85%B7/" itemprop="url">Ubuntu截图工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-10T12:00:00+08:00">
                2016-01-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用Ubuntu已近有一段时间了,但是有时候工作中需要截图，之前用的是win qq的截图，但是大家都懂得，qq在Ubuntu 体验差的要死，还是多年以前的版本。实在不是很方便。于是就找了一下Ubuntu上好的截图方法<br>    方法一：其实Ubuntu是自带截图工具的（注：我用的是Ubuntu 14.04）在／usr/share/applications 中可以看到一个类似于照相机图标的应用</p>
<p><img src="http://img.blog.csdn.net/20160107133254164" alt="Screenshot"></p>
<p>打开之后出现一个窗口你可以选择截取整个屏幕，或者是一个窗口，再或者某个区域，当然系统默认有使用Sreenshot的快捷键　分别为PrtSc, Alt + PrtSc, Shift + PrtSc但是系统自带的没有编辑图片的功能，比如你想模糊一些私密信息，加一些备注，系统的Screenshot就无能为力了。<br>方法二：Shutter<br>Shutter是一个第三方的截图软件需要我们手动的安装，方法很简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install shutter</span><br></pre></td></tr></table></figure>

<p>安装完之后在终端中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfp@cfp:~$ shutter -s</span><br></pre></td></tr></table></figure>
<p>就可以像qq那样截图了<br>当然了shutter 配置了对图片的编辑功能，可以添加备注等等，非常的强大，具体安装后自己体验一下。</p>
<p>另外就是像使用qq的截图功能一样，添加一个快捷键　Ctrl + Alt +A</p>
<p>具体步骤：</p>
<ol>
<li>打开系统设置</li>
<li>打开 Keyboard 键盘设置</li>
<li>选择快捷键</li>
<li>自定义快捷键</li>
<li>添加快捷键</li>
<li>编辑快捷键名称和打开命令</li>
<li>右键设置快捷键　Ctrl + Alt +A</li>
</ol>
<p><img src="http://img.blog.csdn.net/20160107104536475" alt="步骤"></p>
<p>好，这样在Ubuntu上也可以噬无忌惮的截图了！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2016/01/10/2016-01-20-Ubuntu%E7%A7%91%E5%AD%A6%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/10/2016-01-20-Ubuntu%E7%A7%91%E5%AD%A6%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/" itemprop="url">Ubuntu科学上网服务器搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-10T12:00:00+08:00">
                2016-01-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>受天朝GFW的影响，包括大Google在内的很多境外网站访问不了，所以天朝的程序猿大多都练就了一种叫”翻墙”的功夫.从自由门，配置host，到goAgent，再到现在各色各样的vpn，翻墙的姿势也随着时代的发展发生着变化。</p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>代理服务器：<a href="https://bandwagonhost.com/" target="_blank" rel="noopener">搬瓦工</a>（我租的是每月5刀的，1T的流量，对于个人用绰绰有余了）<br>系统：Ubuntu 14.04<br>代理工具：<a href="https://github.com/ziggear/shadowsocks" target="_blank" rel="noopener">shadowsocks</a> (项目的原作者去年被请去喝茶，所以停止更新了，但是相信一个shadowsocks倒下去，成千上万的shadowsocks会站起来)</p>
<h2 id="配置服务器"><a href="#配置服务器" class="headerlink" title="配置服务器"></a>配置服务器</h2><p>1.先到<a href="https://bandwagonhost.com/" target="_blank" rel="noopener">搬瓦工</a>租个云服务器，类似国内的阿里云，腾讯云。</p>
<p><img src="http://img.blog.csdn.net/20160120125049014" alt="这里写图片描述"></p>
<p>之后就是购买的一些流程，比如让你选择服务器的位置（我选的是洛杉矶）还有就是些你的用户信息，支付的时候意外的发现搬瓦工居然支持支付宝，这一点很方便。</p>
<p><img src="http://img.blog.csdn.net/20160120125809421" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20160120131032094" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20160120131245223" alt="填写一些用户信息"></p>
<p><img src="http://img.blog.csdn.net/20160120131649416" alt="支付环节"></p>
<p>支付成功后到Client Area-&gt;Service-&gt;MyService-&gt;KiWiControl Panel<br>就可以看到你服务器的配置信息了</p>
<p><img src="http://img.blog.csdn.net/20160120132507809" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20160120132549684" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20160120132614978" alt="这里写图片描述"></p>
<p>之后的工作就是在服务器上安装shadowsocks.<br>通过终端ssh到服务器，在Ubuntu上安装shadowsocks比较方便，shadowsocks使用python写的（当然也有其他版本的，例如：go语言的），所以需要一个管理python包的工具PIP，安装PIP的命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~# apt–get install python–gevent python–pip</span><br></pre></td></tr></table></figure>

<p>然后可以直接安装 shadowsocks 了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~# pip install shadowsocks</span><br></pre></td></tr></table></figure>

<p>然后就是配置shadowsocks，自己写个配置文件/etc/shadowsocks.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;server&quot;:&quot;你服务器的ip&quot;,</span><br><span class="line">&quot;server_port&quot;:8388,</span><br><span class="line">&quot;password&quot;:&quot;密码&quot;,</span><br><span class="line">&quot;timeout&quot;:300,</span><br><span class="line">&quot;method&quot;:&quot;aes-256-cfb&quot;,</span><br><span class="line">&quot;fast_open&quot;:false,</span><br><span class="line">&quot;workers&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>server: 你自己服务器的ip<br>server_port:给shadowsocks分配的端口，默认是8388<br>password: 你设置的shadowsocks 密码<br>timeout：超时时间，默认是300秒<br>method： 加密方法，默认是aes-256-cfb<br>fast_open: 在Linux3.7+可以使用TCP_FASTOPEN<br>workers:  number of workers (应该是客户端账户的个数，没理解明白)</p>
<p>之后通过下面的命令就可以启动shadowsocks了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks.json -d start</span><br></pre></td></tr></table></figure>

<p>这样服务端的任务就已经完成了</p>
<p>当然了我们也可以把shadowsocks设置为开机自起<br>把上面的命令配置到/etc/rc.local 中就可以了</p>
<p><img src="http://img.blog.csdn.net/20160120144054744" alt="这里写图片描述"></p>
<p>这样，即使重启服务器，shadowsocks也会自动启动</p>
<p>到这里服务端已经大功告成！！！</p>
<hr>
<h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><p>windows系统：需要<a href="https://github.com/shadowsocks/shadowsocks-windows/releases" target="_blank" rel="noopener">shadowsocks客户端</a>，配置如图（我用的是Ubuntu的图，windows界面类似）</p>
<p><img src="http://img.blog.csdn.net/20160120151631242" alt="这里写图片描述"></p>
<p>之后需要配合浏览器的代理服务器功能.</p>
<p>如果利用Chrome插件Proxy SwitchySharp，注意一定要选择SOCKS5 </p>
<p><a href="https://shadowsocks.org/en/download/clients.html" target="_blank" rel="noopener">所有客户端的下载地址</a></p>
<p>~<br>结束<br>–<br>配置比较简单，网上的资料一大堆，最后吐槽一下Baidu最近的血友病事件，一个卖假药，一个研究量子计算机，这就是Baidu和Google的差距。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chengfangpeng.github.io/2015/10/29/2015-10-29-android-animation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chengfangpeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xray的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/29/2015-10-29-android-animation/" itemprop="url">Android属性动画</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-29T12:00:00+08:00">
                2015-10-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Property Animation是Android3.0引入的一种功能强大的动画系统。它除了可以给普通的View添加动画效果外，还可以给对象添加效果。另外，Property Animation与Tween Animation一个最大的区别是Property Animation更改是对象的实际属性，而后者只是View的绘制效果，比如一个Button实现一个移动的动画效果，如果使用Tween Animation 的话，Button 的点击位置并不会随着动画的移动效果儿移动。换句话说在新位置Button是可能没有点击事件的。使用Property Animation可以设置下面的一些动画特性：</p>
<ul>
<li><p>Duration: 动画之间的间隔</p>
</li>
<li><p>Time interpolation: 属性值的变化方式,可以表示为动画的事件函数，例如线性动画，加速动画等等。</p>
</li>
<li><p>Repeat count and behavior: 动画的重复次数和重复方式。</p>
</li>
<li><p>Animation sets: 动画集合</p>
</li>
<li><p>Frame refresh delay: 帧刷新间隔，默认是10ms，但具体的速度依赖于系统的繁忙程度。</p>
</li>
</ul>
<h2 id="属性动画的工作原理"><a href="#属性动画的工作原理" class="headerlink" title="属性动画的工作原理"></a>属性动画的工作原理</h2><p>图１描绘了一个假象的对象x属性的动画，它给出了该对象在屏幕水平方法的位置，在40ms内改对象移动了40个像素。每10ms记录一次对象移动的像素，这个动画是的Time interpolation是liearinterpolation,表明动画是以恒定的速度移动的。</p>
<p><img src="http://7xrrm5.com1.z0.glb.clouddn.com/blog_pic_article_property_animation_1.png" alt="图１"></p>
<p>在Property Animation中，ValueAnimator是其核心类，它记录了动画自身的一些属性值。图2是其工作流程：</p>
<p><img src="http://7xrrm5.com1.z0.glb.clouddn.com/blog_pic_article_property_animation_2.png" alt="图２"></p>
<p>动画在整个过程中，会根据我们当初设置的TimeInterpolator和TypeEvaluator的计算方式计算出不通的属性值，从而不断的改变属性值的大小，就会产生各式各样的动画效果。</p>
<p>下面就通过一个实例理解一下什么是TimeInterpolator和TypeEvaluator.</p>
<ul>
<li>TimeInterpolator</li>
</ul>
<p>TimeInterpolator翻译过来是插值器，插值器定义了动画变化中的属性变化规则，它根据时间比例因子计算出一个插值因子，那么什么是时间比例因子呢，简单讲就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">时间比例因子　＝　动画已执行的时间　／　动画执行的总时间</span><br></pre></td></tr></table></figure>


<p>而插值因子，用于设定动画是线性变化，还是非线性变化等千万中变化，你可以通过实现TimeInterpolator来实现自己的插值器(在&gt;sdk22可以继承抽象类BaseInterpolator)。Android中默认的定义很多的插值器：</p>
<ol>
<li><p>AccelerateDecelerateInterpolator</p>
<p>在开始和结束时速度较慢</p>
</li>
<li><p>AccelerateInterpolator</p>
<p>加速变化</p>
</li>
<li><p>LinearInterpolator</p>
<p> 匀速变化</p>
</li>
</ol>
<p>更多的插值器,可以在<a href="https://developer.android.com/reference/android/animation/TimeInterpolator.html" target="_blank" rel="noopener">这里</a>查看.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//自定义插值器</span><br><span class="line">class MyInterpolator implements TimeInterpolator&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public float getInterpolation(float input) &#123;</span><br><span class="line">        //自定义的规则</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<ul>
<li>TypeEvaluator</li>
</ul>
<p>TypeEvaluator是根据插值因子去计算属性值，Android默认可以识别的类型为int, float和颜色，分别是</p>
<p>IntEvalutor, FloatEvalutor, ArgbEvaluator.</p>
<ol>
<li><p>IntEvalutor</p>
<p> 计算整数型</p>
</li>
<li><p>FloatEvalutor</p>
<p> 计算浮点型</p>
</li>
<li><p>ArgbEvaluator</p>
<p> 计算颜色属性</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//自定义TypeEvaluator</span><br><span class="line">class MyTypeEvaluator implements TypeEvaluator&lt;Ball&gt;&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Ball evaluate(float fraction, Ball startValue, Ball endValue) &#123;</span><br><span class="line">        //自己的规则</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>下面以三个小球的旋转效果为例，了解一下属性动画的整个实现过程。</p>
<p><img src="http://7xrrm5.com1.z0.glb.clouddn.com/blog_pic_article_property_animation_3.png" alt="效果图"></p>
<p>源码可以看<a href="https://github.com/chengfangpeng/BallView" target="_blank" rel="noopener">这里</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class=&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">&lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">chengfangpeng</p>
              <p class="site-description motion-element" itemprop="description">冲出地球，移民宇宙</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chengfangpeng</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
